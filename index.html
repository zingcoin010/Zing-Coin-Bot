<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zing Coin - Entry</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="js/config.js"></script>
</head>
<body>
    <div id="status">Loading Zing Coin...</div>

    <script>
        const tgUser = tg.initDataUnsafe.user;

        if (tgUser) {
            db.ref('users/' + tgUser.id).once('value', (snap) => {
                if (snap.exists()) {
                    localStorage.setItem('zingUser', JSON.stringify(snap.val()));
                    window.location.href = 'pages/home.html';
                } else {
                    const newUser = {
                        id: tgUser.id,
                        username: tgUser.username || "User",
                        coins: 1000, // Welcome Bonus
                        joinedDate: new Date().toISOString()
                    };
                    db.ref('users/' + tgUser.id).set(newUser).then(() => {
                        localStorage.setItem('zingUser', JSON.stringify(newUser));
                        window.location.href = 'pages/home.html';
                    });
                }
            });
        } else {
            document.getElementById('status').innerText = "Please open in Telegram!";
        }
    </script>
</body>
</html>
