<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zing Coin - Friends & Referrals</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <style>
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: #050505; color: white; min-height: 100vh; padding: 20px; padding-bottom: 100px; }

        /* 1. Header */
        .page-title { text-align: center; font-size: 26px; font-weight: 800; color: #fff; margin-bottom: 30px; letter-spacing: 1px; }
        .page-title span { color: #00d2ff; }

        /* 2. Neon Referral Link Box */
        .neon-link-container {
            width: 100%;
            background: #111;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #00d2ff;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.4), inset 0 0 10px rgba(0, 210, 255, 0.2);
            margin-bottom: 30px;
            position: relative;
        }
        .link-label { font-size: 12px; color: #00d2ff; font-weight: 800; margin-bottom: 10px; display: block; text-transform: uppercase; }
        .link-display {
            background: #000;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #fff;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block;
            margin-bottom: 15px;
            border: 1px solid #222;
        }
        .copy-btn {
            width: 100%;
            padding: 12px;
            background: #00d2ff;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
        }

        /* 3 & 4. Referral Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #111;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #222;
        }
        .stat-card i { color: #ffd700; font-size: 20px; margin-bottom: 5px; }
        .stat-value { font-size: 20px; font-weight: 800; display: block; }
        .stat-label { font-size: 10px; color: #555; text-transform: uppercase; }

        /* 5. Friends List */
        .friends-section { width: 100%; }
        .section-header { font-size: 14px; font-weight: 600; color: #777; margin-bottom: 15px; text-transform: uppercase; }
        .friend-item {
            background: #111;
            padding: 12px 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-left: 4px solid #00d2ff;
        }
        .friend-info { display: flex; align-items: center; gap: 12px; }
        .friend-name { font-weight: 600; font-size: 14px; }
        .friend-reward { color: #2ed573; font-weight: 800; font-size: 12px; }

        /* Bottom Nav */
        .footer { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-around; padding: 18px; background: #0a0a0a; border-top: 1px solid #1a1a1a; border-radius: 20px 20px 0 0; }
        .nav-item { color: #444; font-size: 11px; text-align: center; text-decoration: none; font-weight: 700; display: flex; flex-direction: column; gap: 5px; }
        .nav-item.active { color: #00d2ff; }
        .nav-item i { font-size: 22px; }
    </style>
</head>
<body>

    <h1 class="page-title">FRIENDS / <span>REFERRAL</span></h1>

    <div class="neon-link-container">
        <span class="link-label">Your Invite Link</span>
        <span class="link-display" id="referralLink">Loading link...</span>
        <button class="copy-btn" onclick="copyLink()">Copy Link</button>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <i class="fas fa-users"></i>
            <span class="stat-value" id="refCount">0</span>
            <span class="stat-label">Total Referrals</span>
        </div>
        <div class="stat-card">
            <i class="fas fa-coins"></i>
            <span class="stat-value" id="totalEarned">0</span>
            <span class="stat-label">Bonus Earned</span>
        </div>
    </div>

    <div class="friends-section" id="friendsSection" style="display: none;">
        <div class="section-header">Recent Referrals</div>
        <div id="friendsList">
            </div>
    </div>

    <div class="footer">
    <a href="home.html" class="nav-item" id="nav-home">
        <i class="fas fa-gamepad"></i>
        <span>Home</span>
    </a>
    <a href="rank.html" class="nav-item" id="nav-rank">
        <i class="fas fa-trophy"></i>
        <span>Rank</span>
    </a>
    <a href="friends.html" class="nav-item" id="nav-friends">
        <i class="fas fa-user-group"></i>
        <span>Friends</span>
    </a>
    <a href="payout.html" class="nav-item" id="nav-payout">
        <i class="fas fa-wallet"></i>
        <span>Payout</span>
    </a>
</div>

    <script>
        // මේක script එක ඇතුළේ උඩින්ම දාන්න
const tg = window.Telegram.WebApp;
const user = JSON.parse(localStorage.getItem('zingUser'));
const botUsername = "zingcoin_bot"; // මෙතනට ඔයාගේ Bot ගේ Username එක (ඇට ලකුණ නැතුව) දාන්න

function generateReferralLink() {
    if (user && user.id) {
        // රෙෆරල් ලින්ක් එක හදනවා
        const refLink = `https://t.me/${botUsername}?start=${user.id}`;
        
        // පේජ් එකේ "Loading" කියලා තියෙන තැනට මේක දානවා
        const linkElement = document.getElementById('referralLink');
        if(linkElement) {
            linkElement.innerText = refLink;
        }
    }
}

// පේජ් එක ලෝඩ් වුණ ගමන් මේක වැඩ කරන්න ඕනේ
window.onload = () => {
    generateReferralLink();
    // කලින් තිබුණු අනිත් function (fetchFriends වගේ ඒවා) මෙතනටම දාන්න
};
        // --- FIREBASE CONFIG (login.html එකේ එකම දාන්න) ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const user = JSON.parse(localStorage.getItem('zingUser'));

        function initFriends() {
            if (!user) { window.location.href = "login.html"; return; }

            // Set Link
            const botName = "ZingCoinBot"; // ඔයාගේ Bot නම මෙතනට දාන්න
            const inviteLink = `https://t.me/${botName}?start=${user.id}`;
            document.getElementById('referralLink').innerText = inviteLink;

            loadReferrals();
        }

        async function loadReferrals() {
            // යූසර්ගේ referrals ලැයිස්තුව Firebase එකෙන් කියවීම
            db.ref('users/' + user.id + '/referrals').on('value', (snapshot) => {
                const referrals = snapshot.val();
                if (referrals) {
                    document.getElementById('friendsSection').style.display = 'block';
                    const list = document.getElementById('friendsList');
                    list.innerHTML = '';
                    
                    let count = 0;
                    let totalBonus = 0;

                    Object.keys(referrals).forEach(key => {
                        count++;
                        const friend = referrals[key];
                        // රෙෆරල් ක්‍රමය: 1st: 100, 2nd: 200, 3rd: 300, 4th: 100...
                        let bonus = 100;
                        if(count === 2) bonus = 200;
                        if(count === 3) bonus = 300;
                        totalBonus += bonus;

                        list.innerHTML += `
                            <div class="friend-item">
                                <div class="friend-info">
                                    <div class="friend-name">${friend.username}</div>
                                </div>
                                <div class="friend-reward">+${bonus}</div>
                            </div>
                        `;
                    });

                    document.getElementById('refCount').innerText = count;
                    document.getElementById('totalEarned').innerText = totalBonus;
                }
            });
        }

        function copyLink() {
            const link = document.getElementById('referralLink').innerText;
            navigator.clipboard.writeText(link);
            alert("Neon Link Copied! Send to friends.");
        }

        window.onload = initFriends;
        // මේක script එක ඇතුළේ දාන්න
const user = JSON.parse(localStorage.getItem('zingUser'));
const botUsername = "ZingCoin_Bot"; // <--- මෙතනට ඔයාගේ බොට්ගේ නම අනිවාර්යයෙන්ම දාන්න

if (user && user.id) {
    const refLink = `https://t.me/${botUsername}?start=${user.id}`;
    // HTML එකේ id="referralLink" කියලා තියෙන තැනට ලින්ක් එක දානවා
    document.getElementById('referralLink').innerText = refLink;
} else {
    document.getElementById('referralLink').innerText = "Link generation failed!";
}
    </script>
</body>
</html>
